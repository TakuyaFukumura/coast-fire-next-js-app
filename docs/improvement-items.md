# リポジトリ改善項目の洗い出し

## 概要

本ドキュメントでは、Coast FIRE Next.js アプリケーションのリポジトリ内部を調査し、改善が必要な項目を洗い出します。

調査日: 2026-02-15

## プロジェクト概要

- **プロジェクト名**: coast-fire-next-js-app
- **バージョン**: 0.3.0
- **主要技術スタック**:
    - Next.js 16.1.6 (App Router)
    - React 19.2.4
    - TypeScript 5.x
    - Tailwind CSS 4.x
    - Recharts 3.7.0
    - Jest 30.2.0 (テストフレームワーク)

## 調査結果サマリー

### 良好な点

1. **型安全性**: TypeScript を strict モードで使用しており、型安全性が高い
2. **コード品質**: ESLint による静的解析が導入されており、現時点でリントエラーなし
3. **テスト体制**: Jest によるテストが実装されており、計算ロジック（`lib/coastFireCalculations.ts`）のテストカバレッジは約
   87%（実測値: Statement 87.23%, Function 100%）
4. **CI/CD**: GitHub Actions による自動テストとビルド検証が設定済み
5. **依存関係管理**: Dependabot による自動更新が月次で設定されている
6. **ドキュメント**: README.md、CHANGELOG.md が適切に整備されている
7. **コード構造**: コンポーネント化が適切に行われており、関心の分離ができている

### 改善が必要な点

以下のセクションで詳細を記載します。

## 改善項目リスト

### 1. セキュリティ関連

#### 1.1 npm 依存関係の脆弱性

**優先度**: 高

**現状**:

- 調査時点（2026-02-15）では `js-yaml < 3.14.2` に moderate severity の prototype pollution 脆弱性が存在していた
- 本 PR にて `js-yaml@3.14.2` へ更新済みであり、当該脆弱性は解消済み（`package-lock.json` の変更を参照）
- 現在の `npm audit` 実行結果: 0 vulnerabilities

**影響範囲**:

- `@istanbuljs/load-nyc-config/node_modules/js-yaml` (テスト関連の依存関係)
- 開発環境のみで使用されており、本番環境への直接的な影響は限定的

**対応状況**:

- 本 PR で `npm audit fix` を実行し、`js-yaml` の脆弱性は既に解消済み

**今後の推奨対応**:

- 依存関係を更新したタイミングで `npm audit` を定期的に実行し、新たな脆弱性の有無を確認する

#### 1.2 環境変数の管理

**優先度**: 中

**現状**:

- `.env*` ファイルが `.gitignore` に含まれているが、環境変数の使用例やドキュメントがない
- 現時点では環境変数を使用していないが、将来的な拡張のために整備が必要

**推奨対応**:

- `.env.example` ファイルを作成し、必要な環境変数のテンプレートを提供
- README.md に環境変数の設定方法を記載

### 2. テスト関連

#### 2.1 コンポーネントのテストカバレッジ不足

**優先度**: 高

**現状**:

- 全体のコードカバレッジ: 42.66% (Statement)
- ビジネスロジック (`lib/coastFireCalculations.ts`): 87.23% (Statement), 100% (Function)
- コンポーネント (`src/app/components`): 32.73%
    - `AssetChart.tsx`: 0%
    - `AssetTable.tsx`: 0%
    - `CoastFireCalculator.tsx`: 0%
    - `InputForm.tsx`: 0%
    - `ResultDisplay.tsx`: 0%
    - `DarkModeProvider.tsx`: 100% ✓
    - `Header.tsx`: 100% ✓

**影響**:

- UI コンポーネントの動作保証が不十分
- リグレッションの検出が困難

**推奨対応**:

1. 主要コンポーネントのテストを追加:
    - `InputForm.tsx`: フォーム入力、バリデーション、送信のテスト
    - `CoastFireCalculator.tsx`: 状態管理、計算実行、エラーハンドリングのテスト
    - `AssetTable.tsx`: データ表示、ソート、ページネーションのテスト
    - `AssetChart.tsx`: グラフレンダリングのテスト
    - `ResultDisplay.tsx`: 結果表示のテスト

2. 目標カバレッジ: 最低60%以上（Statement Coverage）

#### 2.2 E2E テストの欠如

**優先度**: 中

**現状**:

- 単体テストのみで、E2E テストが未実装
- ユーザーフローの動作保証がない

**推奨対応**:

- Playwright または Cypress を導入して E2E テストを実装
- 主要なユーザーフローをカバー:
    - Coast FIRE 計算機の入力から結果表示まで
    - ダークモード切り替え
    - データテーブルのソートとページネーション

### 3. パフォーマンス関連

#### 3.1 ビルド時の警告

**優先度**: 中

**現状**:

- ビルド時に Recharts から警告が出力される:
  ```
  The width(-1) and height(-1) of chart should be greater than 0
  ```

**影響**:

- 静的ビルド時の警告であり、実行時には問題ない
- しかし、開発体験とコードの品質を下げる要因となる

**推奨対応**:

- `AssetChart.tsx` コンポーネントで ResponsiveContainer のサイズ指定を明示的に設定
- または、SSR/SSG 時にグラフコンポーネントのレンダリングをスキップする処理を追加

#### 3.2 画像最適化の未使用

**優先度**: 低

**現状**:

- `public` ディレクトリに画像ファイルが存在する可能性があるが、Next.js の `Image` コンポーネントの使用状況が不明
- favicon.ico のみ確認

**推奨対応**:

- 今後画像を追加する際は、Next.js の `Image` コンポーネントを使用して自動最適化を活用

### 4. アクセシビリティ関連

#### 4.1 アクセシビリティテストの欠如

**優先度**: 中

**現状**:

- アクセシビリティのテストや検証が未実施
- WCAG 準拠の確認が行われていない

**推奨対応**:

1. `eslint-plugin-jsx-a11y` を導入して、アクセシビリティに関するリンティングを追加
2. `jest-axe` を導入して、自動アクセシビリティテストを実装
3. キーボードナビゲーションの動作確認
4. スクリーンリーダー対応の確認

#### 4.2 カラーコントラスト比の検証

**優先度**: 低

**現状**:

- ダークモード対応は実装済み
- カラーコントラスト比の検証が未実施

**推奨対応**:

- WCAG AA 基準（コントラスト比 4.5:1 以上）の確認
- 特にダークモードでの可読性を検証

### 5. コード品質関連

#### 5.1 型定義の改善余地

**優先度**: 低

**現状**:

- 基本的な型定義は適切に行われている
- より厳密な型定義が可能な箇所が存在

**推奨対応**:

1. ユーティリティ型の活用（例: `Readonly<T>`, `Required<T>` など）
2. `tsconfig.json` の更新検討:
    - `strictNullChecks`: true（既に有効）
    - `noUncheckedIndexedAccess`: true を追加検討

#### 5.2 コメントとドキュメンテーションの充実

**優先度**: 低

**現状**:

- 計算ロジック (`lib/coastFireCalculations.ts`) は JSDoc コメントが充実 ✓
- コンポーネントは型定義のみで、詳細なコメントが少ない

**推奨対応**:

- 複雑なコンポーネントや関数に JSDoc コメントを追加
- Props の説明を JSDoc で記述
- README.md に開発者向けガイドを追加

### 6. 開発体験（DX）関連

#### 6.1 pre-commit フックの導入

**優先度**: 中

**現状**:

- Git pre-commit フックが未設定
- コミット前の自動チェックが行われない

**推奨対応**:

1. `husky` と `lint-staged` を導入
2. コミット前に以下を自動実行:
    - ESLint による静的解析
    - TypeScript の型チェック
    - 変更ファイルのみ Jest テスト実行
    - Prettier によるコードフォーマット（オプション）

#### 6.2 Prettier の導入検討

**優先度**: 低

**現状**:

- コードフォーマッターが未導入
- 開発者間でのコードスタイルの統一が完全ではない可能性

**推奨対応**:

- Prettier を導入してコードスタイルを自動統一
- `.prettierrc` でプロジェクト固有の設定を定義
- ESLint との統合（`eslint-config-prettier`）

#### 6.3 VSCode 推奨設定の提供

**優先度**: 低

**現状**:

- `.vscode` ディレクトリが存在しない
- 開発環境の統一が図られていない

**推奨対応**:

- `.vscode/settings.json` を作成し、推奨設定を提供
- `.vscode/extensions.json` で推奨拡張機能を定義
- 例: ESLint、TypeScript、Tailwind CSS IntelliSense など

### 7. デプロイとモニタリング

#### 7.1 デプロイ設定の文書化

**優先度**: 低

**現状**:

- README.md にローカル実行方法は記載されている
- デプロイ方法やプラットフォームの情報が不足

**推奨対応**:

- 推奨デプロイ先（Vercel、Netlify など）の記載
- デプロイ手順の文書化
- 環境変数の設定方法の記載

#### 7.2 エラー追跡とモニタリング

**優先度**: 低

**現状**:

- エラー追跡ツールが未導入
- 本番環境でのエラー監視が不可能

**推奨対応**:

- Sentry などのエラー追跡ツールの導入検討
- Web Vitals のモニタリング導入

### 8. 国際化（i18n）対応

#### 8.1 多言語対応の準備

**優先度**: 低（将来的な拡張として）

**現状**:

- 日本語のみ対応
- ハードコードされた日本語テキストが多数存在

**推奨対応**:

- 将来的に多言語対応が必要な場合:
    - `next-intl` または `react-i18next` の導入
    - 翻訳ファイルの作成
    - コンポーネント内のテキストを翻訳関数に置き換え

### 9. ドキュメント関連

#### 9.1 アーキテクチャドキュメントの作成

**優先度**: 低

**現状**:

- README.md にプロジェクト構造は記載されている
- アーキテクチャの設計思想や意思決定の背景が不明

**推奨対応**:

- `docs/architecture.md` を作成し、以下を記載:
    - 技術選定の理由
    - データフローの説明
    - 状態管理の方針
    - コンポーネント設計の原則

#### 9.2 コントリビューションガイドの作成

**優先度**: 低

**現状**:

- `CONTRIBUTING.md` が存在しない
- コントリビュート方法が不明確

**推奨対応**:

- `CONTRIBUTING.md` を作成し、以下を記載:
    - 開発環境のセットアップ手順
    - ブランチ戦略
    - コミットメッセージの規約
    - プルリクエストのガイドライン
    - コードレビューのプロセス

### 10. CI/CD の改善

#### 10.1 CI の最適化

**優先度**: 低

**現状**:

- CI は基本的な機能を持っているが、さらなる最適化が可能

**推奨対応**:

1. キャッシュの活用を最大化
2. 並列実行の最適化（現在は lint → build → test の順次実行）
3. マトリックステストの拡張（複数の Node.js バージョンでテスト）
4. 失敗時の通知設定

#### 10.2 CD パイプラインの構築

**優先度**: 低

**現状**:

- CI（継続的インテグレーション）のみ実装
- CD（継続的デリバリー/デプロイ）が未実装

**推奨対応**:

- main ブランチへのマージ時に自動デプロイを行う GitHub Actions ワークフローを作成
- プレビューデプロイの設定（プルリクエスト毎に一時的な環境を作成）

## 優先度別実施推奨順序

### 高優先度（即座に対応すべき項目）

1. **npm 依存関係の脆弱性修正** (項目 1.1)
    - 影響: セキュリティ
    - 作業時間: 5分

2. **コンポーネントのテストカバレッジ向上** (項目 2.1)
    - 影響: コード品質、リグレッション防止
    - 作業時間: 4-8時間

### 中優先度（近いうちに対応すべき項目）

3. **pre-commit フックの導入** (項目 6.1)
    - 影響: 開発体験、コード品質
    - 作業時間: 1-2時間

4. **ビルド時の警告解消** (項目 3.1)
    - 影響: 開発体験
    - 作業時間: 30分-1時間

5. **アクセシビリティテストの導入** (項目 4.1)
    - 影響: ユーザビリティ、法的準拠
    - 作業時間: 2-4時間

6. **E2E テストの実装** (項目 2.2)
    - 影響: 品質保証
    - 作業時間: 4-6時間

7. **環境変数の管理整備** (項目 1.2)
    - 影響: セキュリティ、拡張性
    - 作業時間: 30分

### 低優先度（余裕があれば対応する項目）

8. その他の項目（項目 3.2, 4.2, 5.1, 5.2, 6.2, 6.3, 7.1, 7.2, 8.1, 9.1, 9.2, 10.1, 10.2）
    - 影響: 開発体験、将来的な拡張性
    - 作業時間: 各30分-4時間

## 推奨実施計画

### フェーズ1: セキュリティとテスト（1-2週間）

- [x] 依存関係の脆弱性修正
- [ ] コンポーネントテストの追加（主要コンポーネント）
- [ ] アクセシビリティリンターの導入

### フェーズ2: 開発体験の向上（1週間）

- [ ] pre-commit フックの導入
- [ ] ビルド警告の解消
- [ ] VSCode 推奨設定の提供

### フェーズ3: テストとドキュメントの充実（1-2週間）

- [ ] E2E テストの実装
- [ ] アーキテクチャドキュメントの作成
- [ ] コントリビューションガイドの作成

### フェーズ4: 将来的な拡張対応（優先度低）

- [ ] エラー追跡ツールの導入
- [ ] CI/CD の最適化
- [ ] デプロイ文書化

## まとめ

Coast FIRE Next.js アプリケーションは、基本的なコード品質と開発体制が整っており、良好な状態にあります。しかし、テストカバレッジの向上、アクセシビリティ対応、開発体験の改善などの観点で、さらなる品質向上が可能です。

上記の改善項目を段階的に実施することで、より堅牢で保守性の高いアプリケーションに進化させることができます。

---

**作成日**: 2026-02-15  
**作成者**: GitHub Copilot Coding Agent  
**対象バージョン**: 0.3.0
