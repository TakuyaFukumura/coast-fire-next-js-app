# Coast FIRE計算アプリ 仕様書

## 1. 概要

### 1.1 アプリケーションの目的
Coast FIRE（Coast Financial Independence, Retire Early）計算アプリは、老後の目標資産額を達成するために現時点で必要な資産額を計算するためのツールです。複利運用を前提とし、ユーザーが設定した条件に基づいて、目標達成までの資産推移を視覚的に表示します。

### 1.2 想定ユーザー
- 老後資金の準備を計画している方
- FIRE（経済的自立・早期退職）を目指している方
- 資産運用のシミュレーションを行いたい方

### 1.3 想定運用方法
全世界インデックス投資などの複利運用を想定しています。

## 2. 機能要件

### 2.1 入力パラメータ

#### 2.1.1 必須パラメータ
| パラメータ名 | 説明 | デフォルト値 | 入力範囲 | 単位 |
|------------|------|------------|---------|------|
| 目標資産額 | 老後に必要な資産額 | 2,000万円 | 100万円〜1億円 | 円 |
| 目標達成年齢 | 資産目標を達成したい年齢 | 65歳 | 30歳〜100歳 | 歳 |
| 現在の年齢 | ユーザーの現在の年齢 | 28歳 | 18歳〜99歳 | 歳 |
| 運用利回り | 年間の期待リターン率 | 5% | 0%〜20% | % |
| インフレ率 | 年間の物価上昇率 | 2% | 0%〜10% | % |

#### 2.1.2 バリデーションルール
- 目標達成年齢 > 現在の年齢
- 金額と年齢は正の値、パーセンテージは0以上の値
- パーセンテージは小数点第2位まで入力可能
- 金額は万円単位で入力

### 2.2 計算機能

#### 2.2.0 重要な前提条件
本アプリでは、ユーザーが設定する「目標資産額」は**現在の購買力ベース**での目標額を意味します。つまり、「65歳時点で今の物価感で2,000万円分の購買力が欲しい」という場合、目標資産額を2,000万円と設定します。

この場合、インフレを考慮すると、実際には65歳時点でより多くの名目金額（例：インフレ率2%で37年後なら約4,100万円）が必要になりますが、その「インフレ調整後の実質価値」が目標の2,000万円となります。

#### 2.2.1 現在必要な資産額の計算
Coast FIREの核となる計算式（目標額は現在価値ベース）：

```
現在必要な資産額 = 目標資産額（現在価値） / (1 + 実質利回り)^運用年数

実質利回り = (1 + 運用利回り) / (1 + インフレ率) - 1
運用年数 = 目標達成年齢 - 現在の年齢
```

この計算により、現時点で必要な資産額を求めます。この資産を運用利回りで運用すると、目標年齢時点での「インフレ調整後価値」が目標額に達します。

#### 2.2.2 年齢ごとの資産推移計算
各年齢における資産額を計算：

```
各年の資産額 = 現在必要な資産額 × (1 + 運用利回り)^経過年数

経過年数 = 対象年齢 - 現在の年齢
```

#### 2.2.3 インフレ調整後価値の計算
将来の名目資産額を現在の購買力に換算：

```
インフレ調整後価値 = 各年の資産額 / (1 + インフレ率)^経過年数
```

**重要：** 目標年齢（例：65歳）時点でのインフレ調整後価値は、設定した目標資産額（例：2,000万円）と一致します。これにより「今の物価感で2,000万円分の購買力」が実現されます。

### 2.3 表示機能

#### 2.3.1 計算結果の表示
**レイアウト優先順位：**
1. **計算結果エリア（最上部）**
   - 現在必要な資産額を大きく表示
   - 目標資産額との比較
   - 達成までの年数表示

**表示例：**
```
┌─────────────────────────────────────────┐
│  現在必要な資産額                         │
│                                          │
│       812万円                            │
│                                          │
│  目標: 2,000万円（現在価値、65歳時点）     │
│  運用期間: 37年                          │
│  ※65歳時の名目額: 約4,104万円            │
└─────────────────────────────────────────┘
```

**注記：** 目標額は「現在の購買力ベース」での金額です。インフレを考慮すると、65歳時点での実際の名目金額はより大きくなります。

#### 2.3.2 資産推移グラフ（グラフエリア）
**仕様：**
- **グラフタイプ：** 折れ線グラフ
- **横軸（X軸）：** 年齢（現在の年齢〜目標達成年齢）
- **縦軸（Y軸）：** 資産額
  - 表示形式：「500万円」「1000万円」「2000万円」など漢字単位で短縮表示
  - 自動スケーリング機能
- **プロット線：**
  - メインライン：資産額の推移（青色）
  - サブライン（オプション）：インフレ調整後価値（グレー/点線）
- **インタラクティブ機能：**
  - ホバー時に詳細情報表示（年齢、資産額、実質価値）
  - レスポンシブデザイン対応

#### 2.3.3 詳細データテーブル（テーブルエリア）
グラフ下部に年齢ごとの詳細データを表形式で表示：

| 年齢 | 資産額（名目） | インフレ調整後価値（実質） | 実質利回り累計 |
|-----|-------------|----------------------|--------------|
| 28歳 | 812万円 | 812万円 | 0% |
| 29歳 | 853万円 | 836万円 | 3.0% |
| 30歳 | 895万円 | 860万円 | 5.9% |
| ... | ... | ... | ... |
| 65歳 | 4,104万円 | 2,000万円 | 146.3% |

**注記：** 目標は「現在価値で2,000万円」であり、65歳時点のインフレ調整後価値が2,000万円になります。インフレ率2%で37年後の名目額は約4,104万円になります。

**テーブル機能：**
- ページネーション（10行ずつ表示）
- ソート機能（各列クリックで昇順/降順）
- CSV出力機能（オプション）

#### 2.3.4 入力フォームエリア
**配置：** 画面右サイドバーまたは最下部

**入力項目：**
- 目標資産額（スライダー + 数値入力）
- 目標達成年齢（スライダー + 数値入力）
- 現在の年齢（数値入力）
- 運用利回り（スライダー + 数値入力）
- インフレ率（スライダー + 数値入力）

**ボタン：**
- 「再計算」ボタン：入力値を反映して計算を実行
- 「リセット」ボタン：デフォルト値に戻す

### 2.4 レスポンシブデザイン
- **デスクトップ（1024px以上）：** サイドバー + メインコンテンツのレイアウト
- **タブレット（768px〜1023px）：** 縦積みレイアウト
- **モバイル（767px以下）：** 単一カラムレイアウト、スクロール対応

## 3. 技術要件

### 3.1 技術スタック
- **フロントエンド：** Next.js 16.x（App Router）
- **言語：** TypeScript
- **スタイリング：** Tailwind CSS 4.x
- **グラフライブラリ：** Recharts または Chart.js
- **状態管理：** React Hooks（useState, useEffect）
- **フォーム処理：** React Hook Form（オプション）

### 3.2 ファイル構成案
```
./
├── lib/
│   └── coastFireCalculations.ts      # 計算ロジック関数（既存のルート直下 lib/ 配下）
└── src/
    ├── app/
    │   ├── coast-fire/
    │   │   ├── page.tsx              # Coast FIREメインページ
    │   │   └── layout.tsx            # Coast FIREレイアウト（オプション）
    │   └── components/
    │       ├── CoastFireCalculator.tsx    # 計算ロジックコンポーネント
    │       ├── ResultDisplay.tsx          # 計算結果表示
    │       ├── AssetChart.tsx             # 資産推移グラフ
    │       ├── AssetTable.tsx             # 詳細データテーブル
    │       └── InputForm.tsx              # 入力フォーム
    └── types/
        └── coastFire.ts              # 型定義（新規作成ディレクトリ）
```

### 3.3 計算ロジック実装（coastFireCalculations.ts）
```typescript
export interface CoastFireInput {
  targetAmount: number;        // 目標資産額（万円単位での入力値）
  targetAge: number;            // 目標達成年齢
  currentAge: number;           // 現在の年齢
  returnRate: number;           // 運用利回り（小数、例: 0.05 = 5%）
  inflationRate: number;        // インフレ率（小数、例: 0.02 = 2%）
}

export interface CoastFireResult {
  requiredAmount: number;       // 現在必要な資産額（万円）
  yearlyData: YearlyData[];     // 年齢ごとのデータ
  realReturnRate: number;       // 実質利回り
  investmentYears: number;      // 運用年数
}

export interface YearlyData {
  age: number;                  // 年齢
  amount: number;               // 資産額（名目、万円）
  inflationAdjusted: number;    // インフレ調整後価値（実質、万円）
  realReturn: number;           // 実質利回り累計
}

export function calculateCoastFire(input: CoastFireInput): CoastFireResult {
  // 計算ロジック実装
  // 注: targetAmountは現在価値ベースの目標額
  // 目標年齢でのinflationAdjustedがtargetAmountと一致するように計算
}
```

**計算の流れ：**
1. ユーザーは万円単位で入力（例：2000万円）
2. 内部計算は万円のまま実施（精度十分）
3. 表示も万円単位で行う

### 3.4 パフォーマンス要件
- 初回レンダリング：2秒以内
- 再計算処理：100ms以内
- グラフ描画：500ms以内

### 3.5 アクセシビリティ
- WCAG 2.1 Level AA準拠
- キーボード操作対応
- スクリーンリーダー対応
- カラーコントラスト比4.5:1以上

## 4. UI/UXデザイン要件

### 4.1 デザイン原則
- **シンプルさ：** 複雑な金融計算を分かりやすく表現
- **視覚的明瞭性：** 重要な数値を目立たせる
- **インタラクティブ性：** リアルタイムでの計算反映
- **信頼性：** 正確な計算結果の提供

### 4.2 カラーパレット
- **プライマリカラー：** 青系（信頼感）
- **セカンダリカラー：** 緑系（成長・増加）
- **警告カラー：** オレンジ系（注意事項）
- **背景：** 白/ダークグレー（ダークモード対応）

### 4.3 フォント
- **数値表示：** ゴシック体、大きめのフォントサイズ
- **説明文：** 明朝体またはゴシック体、読みやすいサイズ

## 5. テスト要件

### 5.1 単体テスト
- 計算ロジックのテスト（coastFireCalculations.ts）
- 各コンポーネントのレンダリングテスト
- バリデーションロジックのテスト

### 5.2 統合テスト
- ユーザー入力から計算結果表示までのフロー
- グラフとテーブルのデータ整合性

### 5.3 E2Eテスト（オプション）
- ユーザーシナリオに基づいた操作テスト

### 5.4 テストカバレッジ目標
- 計算ロジック：100%
- コンポーネント：80%以上

## 6. セキュリティ要件

### 6.1 データ保護
- ユーザー入力データはクライアントサイドのみで処理
- サーバーサイドへの送信は行わない（プライバシー保護）
- localStorageへの設定保存（オプション機能）

### 6.2 入力検証
- すべての入力値に対するバリデーション
- XSS対策（TypeScript + Reactによる自動エスケープ）
- 不正な数値入力の防止

## 7. 今後の拡張機能（将来的な検討事項）

### 7.1 Phase 2（次期バージョン）
- **追加入金シミュレーション：** 毎月の積立額を考慮した計算
- **複数シナリオ比較：** 異なる条件での同時比較
- **設定保存機能：** ユーザー設定のlocalStorage保存
- **PDF出力：** 計算結果のレポート出力

### 7.2 Phase 3（さらなる将来）
- **ユーザー登録機能：** 計算履歴の保存
- **SNSシェア機能：** 結果のシェア
- **多言語対応：** 英語版の提供
- **モンテカルロシミュレーション：** 確率的なリスク分析

## 8. 実装スケジュール案

### 8.1 フェーズ1：基本機能（2週間）
- Week 1: 計算ロジック実装 + 基本UI
- Week 2: グラフ表示 + テーブル表示

### 8.2 フェーズ2：改善・テスト（1週間）
- レスポンシブデザイン対応
- 単体テスト・統合テスト実装
- パフォーマンス最適化

### 8.3 フェーズ3：リリース準備（1週間）
- ドキュメント整備
- アクセシビリティチェック
- クロスブラウザテスト

## 9. 参考資料

### 9.1 Coast FIREの概念
Coast FIREとは、現時点である程度の資産を確保すれば、その後は追加投資なしで複利運用だけで目標資産額に到達できる状態を指します。これにより、より柔軟な働き方やキャリア選択が可能になります。

### 9.2 計算式の根拠
- 複利計算の基本式：FV = PV × (1 + r)^n
- 実質利回りの計算：フィッシャー方程式を使用
- インフレ調整：購買力平価の考え方を適用

### 9.3 関連リンク
- [FIRE（Financial Independence Retire Early）とは](https://ja.wikipedia.org/wiki/FIRE%E3%83%A0%E3%83%BC%E3%83%96%E3%83%A1%E3%83%B3%E3%83%88)
- [Next.js公式ドキュメント](https://nextjs.org/docs)
- [Recharts公式ドキュメント](https://recharts.org/)
- [Tailwind CSS公式ドキュメント](https://tailwindcss.com/docs)

## 10. 用語集

| 用語 | 説明 |
|-----|------|
| Coast FIRE | 現時点で必要な資産を確保し、追加投資なしで複利運用のみで目標達成を目指す手法 |
| 実質利回り | インフレ率を考慮した実際の資産増加率 |
| インフレ調整後価値 | 将来の金額を現在の購買力に換算した価値 |
| 複利運用 | 元本に対する利子が再投資され、利子に対しても利子が発生する運用方法 |
| インデックス投資 | 市場全体の動きを示す指数（インデックス）に連動した投資 |

---

**文書バージョン：** 1.0  
**作成日：** 2026年02月14日  
**最終更新日：** 2026年02月14日
